<!DOCTYPE html>
<html>

<head>
<title>Master of Parkour</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P" rel="stylesheet">
<style>
body {
    font-family: "Press Start 2P", sans-serif;
}

#game-container {
    position: relative;
}

#player2 {
    position: absolute;
    top: 0px;
    left: 750px;
}

#player1,
#counter,
#game-start,
#game-over {
    position: absolute;
    top: 0px;
    left: 0px;
}

#game-start,
#game-over {
    border: 1px solid gray;
    width: 1450px;
    height: 400px;
}

canvas {
    border: 1px solid gray;
    width: 700px;
    height: 400px;
}

canvas {
    background-size: cover;
    background: url(assets/background/backgroundtext.png);
}

#game-start,
#game-over {
    background: rgba(1, 1, 1, 0.8);
}

#counter text {
    font-size: 130%;
    fill: white;
    stroke: black;
    stroke-width: 1px;
}

#game-start text {
    font-size: 150%;
    fill: white;
    text-anchor: middle;
}

#game-start #game-title {
    font-size: 400%;
    fill: url(#title-fill);
    stroke: black;
}

#game-over text {
    font-size: 120%;
    fill: url(#game-over-fill);
    text-anchor: middle;
}

.canvas-container {
    display: flex;
    width: 40%;
}

#text-waiting {
    position: absolute;
    left: 33%;
    top: 160px;
    color: red;
    align-content: center;
}

#loader-focus {
    position: absolute;
    left: 44%;
    top: 260px;
    z-index: 1;
    width: 120px;
    height: 120px;
    margin: -76px 0 0 -76px;
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid #3498db;
    animation: spin 2s linear infinite;
}

#focus {
    display: none;
}

#text-focus {
    position: absolute;
    left: 33%;
    top: 160px;
    color: red;
    align-content: center;
}

#text-focus {
    font-size: 150%;
    text-align: center;
}

#loader {
    position: absolute;
    left: 44%;
    top: 260px;
    z-index: 1;
    width: 120px;
    height: 120px;
    margin: -76px 0 0 -76px;
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid #3498db;
    animation: spin 2s linear infinite;
}

#waiting {
    display: none;
}

#focus {
    display: none;
}

#text-waiting {
    font-size: 150%;
    text-align: center;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
</style>
</head>

<body>
<div id="game-container">
<canvas id="player1" width="600px" height="600px"></canvas>
<canvas id="player2" width="600px" height="600px"></canvas>
<div id="waiting">
<div id="text-waiting">
Waiting for other player
</div>
<div id="loader">
</div>
</div>
<div id="focus">
<div id="text-focus">
Other player is not focus
</div>
<div id="loader-focus">
</div>
</div>
<audio id="background-sound">
    <source src="assets/sound/background-sound.mp3">
</audio>
<svg xmlns="http://www.w3.org/2000/svg" id="game-start">
            <defs>
                <linearGradient id="title-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0.2" stop-color="red" />
                    <stop offset="0.4" stop-color="yellow" />
                    <stop offset="0.6" stop-color="green" />
                    <stop offset="0.8" stop-color="purple" />
                </linearGradient>
            </defs>
        </svg>

<svg xmlns="http://www.w3.org/2000/svg" id="game-over" style="display: none">
            <defs>
                <linearGradient id="game-over-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="red" />
                    <stop offset="0.5" stop-color="yellow" />
                    <stop offset="1" stop-color="red" />
                </linearGradient>
            </defs>
            <text x="50%" y="50%">
                Game finish. 
                <tspan id="winner-game"></tspan>
            </text>
        </svg>
</div>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="gameScript/bounding_box.js"></script>
<script src="gameScript/sprite.js"></script>
<script src="gameScript/player.js"></script>
<script src="gameScript/platform.js"></script>
<script src="gameScript/trap.js"></script>
<script src="gameScript/savePoint.js"></script>
<script src="gameScript/gameObject.js"></script>
<script src="gameScript/cherry.js"></script>
<script src="gameScript/winPoint.js"></script>
<script src="gameScript/game.js"></script>
<script src="scripts/socket.js"></script>
<script src="scripts/gamestate.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {})

$(document).ready(function() {
    const sounds = {
        collect: new Audio("assets/sound/cherry-collect.mp3"),
        dead: new Audio("assets/sound/dead-sound.mp3"),
        savepoint: new Audio("assets/sound/savepoint-sound.mp3"),
        gameover: new Audio("assets/sound/gameover-sound.mp3")
    };
    gameArea(GameState.getPlayer(), GameState.getGameState(), "#player1", sounds);
    gameArea(GameState.getPlayer(), GameState.getGameState(), "#player2", sounds);



    $(document).on("keydown", function(event) {
        if (!GameState.getIsStart()) return;
        if (GameState.getPause()) return;
        /* TODO */
        /* Handle the key down */
        if (GameState.getPlayer().player1 != null && GameState.getPlayer().player2 != null) {
            switch (event.keyCode) {
                case 37:
                    Socket.getSocket().emit('player-move', {
                        index: 1,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 38:
                    Socket.getSocket().emit('player-move', {
                        index: 3,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 39:
                    Socket.getSocket().emit('player-move', {
                        index: 2,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 81:
                    Socket.getSocket().emit('player-cheat', "1");
                    break;
            }
        }
    });

    /* Handle the keyup of arrow keys and spacebar */
    $(document).on("keyup", function(event) {
        if (!GameState.getIsStart()) return;
        if (GameState.getPause()) return;
        /* TODO */
        /* Handle the key up */
        if (GameState.getPlayer().player1 != null) {
            switch (event.keyCode) {
                case 37:
                    Socket.getSocket().emit('player-stop', {
                        index: 1,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 39:
                    Socket.getSocket().emit('player-stop', {
                        index: 2,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 38:
                    Socket.getSocket().emit('player-stop', {
                        index: 3,
                        distance: GameState.getPlayer().player1.getTotalDistance(),
                        y: GameState.getPlayer().player1.getXY().y,
                    });
                    break;
                case 81:
                    Socket.getSocket().emit('reset-player-cheat', "1");
                    break;
            }
        }
    });

});

function checkWindowFocused() {
    if (document.hidden) {
        Socket.getSocket().emit('player-focus', "0");
    } else {
        Socket.getSocket().emit('player-focus', "1");
    }
}

setInterval(checkWindowFocused, 300);
</script>
</body>

</html>